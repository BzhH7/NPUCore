# NPUcore-Ovo 项目概述文档

## 1. 项目简介

### 1.1 项目名称
**OSKernel2025-NPUcore-Ovo** (RISC-V + LoongArch 双架构操作系统内核)

### 1.2 项目背景
NPUcore-Ovo 是基于 `NPUcore-BLOSSOM` 框架开发的竞赛操作系统内核，参考借鉴了多个优秀参赛队伍与 Linux 内核的设计理念，完善其内部功能实现并进行迭代升级而形成的操作系统。

### 1.3 项目目标
- 提供一个支持 RISC-V 和 LoongArch 双架构的操作系统内核
- 实现完整的进程管理、内存管理、文件系统、网络协议栈等核心功能
- 参与全国大学生计算机系统能力大赛操作系统设计赛

## 2. 项目特性

### 2.1 双架构支持
| 架构 | 目标平台 | 状态 |
|------|---------|------|
| RISC-V 64 (rv64gc) | QEMU virt / VisionFive2 | ✅ 支持 |
| LoongArch 64 | QEMU / 2K1000 开发板 | ✅ 支持 |

### 2.2 核心功能
- **进程管理**: 多进程/多线程、CFS公平调度、实时调度、信号处理
- **内存管理**: 分页虚拟内存、写时复制 (CoW)、ZRAM 压缩、Next-Fit分配
- **文件系统**: FAT32、EXT4 文件系统支持
- **设备驱动**: VirtIO 块设备、SATA、串口等
- **网络协议栈**: TCP/UDP Socket、smoltcp 协议栈
- **系统调用**: 兼容 Linux 系统调用接口

### 2.3 高级特性
- **多核 SMP**: 对称多处理支持，Per-CPU架构
- **多级调度**: RT实时调度 + CFS公平调度 + Idle调度
- **状态机验证**: 原子状态转换，保证多核一致性
- **错误处理**: 统一的内核错误处理框架
- **性能监控**: 系统诊断与性能指标收集
- **工作窃取**: 多核负载均衡
- OOM (Out of Memory) 处理机制
- Swap 交换空间支持
- 页面缓存 (Page Cache)
- Futex 快速用户空间互斥锁

## 3. 技术栈

### 3.1 开发语言
- **主要语言**: Rust (no_std 环境)
- **辅助语言**: 汇编语言 (RISC-V/LoongArch)

### 3.2 工具链
| 工具 | 版本/描述 |
|------|-----------|
| Rust Toolchain | nightly-2024-05-01 |
| RISC-V Target | riscv64gc-unknown-none-elf |
| LoongArch Target | loongarch64-unknown-none |
| QEMU | 系统模拟器 |

### 3.3 核心依赖库
| 依赖 | 用途 |
|------|------|
| lazy_static | 静态变量延迟初始化 |
| buddy_system_allocator | 伙伴系统内存分配器 |
| spin | 自旋锁实现 |
| bitflags | 位标志处理 |
| xmas-elf | ELF 文件解析 |
| virtio-drivers | VirtIO 设备驱动 |
| smoltcp | TCP/IP 协议栈 |
| log | 日志框架 |

## 4. 项目结构概览

```
oskernel2025-ovo/
├── os/                     # 内核主代码
│   ├── src/                # 源代码目录
│   │   ├── main.rs         # 内核入口
│   │   ├── mm/             # 内存管理模块
│   │   ├── task/           # 进程/线程管理
│   │   │   ├── mod.rs              # 任务管理入口
│   │   │   ├── task.rs             # 任务控制块
│   │   │   ├── manager.rs          # 任务调度器
│   │   │   ├── processor.rs        # Per-CPU处理器
│   │   │   ├── cfs_scheduler.rs    # CFS调度器
│   │   │   ├── sched_class.rs      # 多级调度框架
│   │   │   └── state_machine.rs    # 状态机验证
│   │   ├── fs/             # 文件系统
│   │   ├── syscall/        # 系统调用
│   │   │   ├── dispatch.rs         # 系统调用分发
│   │   │   └── ...
│   │   ├── drivers/        # 设备驱动
│   │   ├── net/            # 网络协议栈
│   │   ├── hal/            # 硬件抽象层
│   │   │   ├── arch/
│   │   │   │   ├── riscv/          # RISC-V架构实现
│   │   │   │   └── loongarch64/    # LoongArch实现
│   │   │   └── mod.rs
│   │   └── utils/          # 工具模块
│   │       ├── kerror.rs           # 错误处理框架
│   │       └── trace.rs            # 诊断与追踪
│   ├── Makefile            # 构建脚本
│   └── Cargo.toml          # Rust 项目配置
├── user/                   # 用户态程序
├── dependency/             # 外部依赖库
├── bootloader/             # 引导加载程序
├── apps/                   # 应用程序
├── util/                   # 工具程序
├── fs-img-dir/             # 文件系统镜像目录
└── docs/                   # 文档目录
    ├── 项目概述.md
    ├── 系统架构设计.md
    ├── 模块设计.md
    ├── 更新日志-多核与调度.md
    └── ...
```

## 5. 版本信息与重要更新

### 5.1 版本信息
- **当前版本**: 0.2.0 (多核与调度框架版本)
- **Rust Edition**: 2018
- **许可证**: 见 LICENSE 文件

### 5.2 最新重大更新 (2025.12 - 2026.01)

#### 多核支持
- ✅ Per-CPU架构设计
- ✅ 多核启动流程 (BSP/AP协调)
- ✅ 工作窃取与负载均衡
- ✅ 原子标记防止任务竞争

#### 调度框架
- ✅ CFS公平调度器 (基于vruntime)
- ✅ 实时调度 (SCHED_FIFO/SCHED_RR)
- ✅ 多级调度类 (RT/CFS/Idle)
- ✅ Nice值权重映射
- ✅ 可配置调度参数

#### 系统增强
- ✅ 进程状态机验证
- ✅ 统一错误处理框架
- ✅ 系统诊断与性能指标
- ✅ SyscallContext模式
- ✅ Next-Fit内存分配器

**详见**: [更新日志-多核与调度.md](./更新日志-多核与调度.md)

## 6. 参考资料

- Linux 内核源码
- rCore-Tutorial
- NPUcore-BLOSSOM 框架
- RISC-V 特权级规范
- LoongArch 架构手册

## 7. 维护团队

本项目由参加全国大学生计算机系统能力大赛的团队维护开发。

---

*文档版本: 1.0*  
*最后更新: 2026年1月*
